{"ast":null,"code":"var _jsxFileName = \"/home/shkwon/Projects/Learn_Ethereum/chapter10/DigitalArtERC721Token/dapp/src/ArtHome.js\";\nimport React from 'react';\nimport './App.css';\nimport AppNav from \"./AppNav\";\nimport { getWeb3, getInstance } from \"./Web3Util\";\n\nclass ArtHome extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.componentDidMount = async () => {\n      const web3 = await getWeb3();\n      window.web3 = web3;\n      const contractInstance = await getInstance(web3);\n      window.user = (await web3.eth.getAccounts())[0];\n      this.setState({\n        user: window.user\n      });\n      this.setState({\n        contractInstance: contractInstance\n      });\n      await this.loadDigitalArts(web3);\n    };\n\n    this.state = {\n      hasData: false,\n      message: \"\",\n      rows: [],\n      columns: [],\n      //user: '',\n      tokenIds: [],\n      title: [],\n      desc: [],\n      price: [],\n      publishDate: [],\n      author: [],\n      image: [],\n      total: 0,\n      contractInstance: '',\n      user: ''\n    };\n    this.buyArt = this.buyArt.bind(this);\n  }\n\n  resetPendingArts() {\n    this.setState({\n      tokenIds: [],\n      title: [],\n      desc: [],\n      price: [],\n      publishDate: [],\n      author: [],\n      image: [],\n      total: 0\n    });\n  }\n\n  async loadDigitalArts(web3) {\n    try {\n      let ids;\n      const result = await this.state.contractInstance.methods.findAllPendingArt().call();\n      ids = result[0];\n      let _total = ids.length;\n\n      if (ids && _total > 0) {\n        let row;\n\n        if (_total <= 3) {\n          row = 1;\n        } else {\n          row = Math.ceil(_total / 3);\n        }\n\n        let columns = 3;\n        this.setState({\n          rows: [],\n          columns: []\n        });\n        let rowArr = Array.apply(null, {\n          length: row\n        }).map(Number.call, Number);\n        let colArr = Array.apply(null, {\n          length: columns\n        }).map(Number.call, Number);\n        this.setState({\n          rows: rowArr,\n          columns: colArr\n        });\n        let _tokenIds = [],\n            _title = [],\n            _desc = [],\n            _price = [],\n            _publishDate = [],\n            _image = [],\n            _author = [];\n        let idx = 0;\n        this.resetPendingArts();\n\n        for (let i = 0; i < row; i++) {\n          for (let j = 0; j < columns; j++) {\n            if (idx < _total) {\n              let tokenId = ids[idx];\n              const art = await this.state.contractInstance.methods.findArt(tokenId).call();\n              const priceInEther = web3.utils.fromWei(art[3], 'ether');\n\n              _tokenIds.push(art[0]);\n\n              _title.push(art[1]);\n\n              _desc.push(art[2]);\n\n              _price.push(priceInEther);\n\n              _publishDate.push(art[5]);\n\n              _image.push(art[9]);\n\n              _author.push(art[6]);\n            }\n\n            idx++;\n          }\n        }\n\n        this.setState({\n          tokenIds: _tokenIds,\n          title: _title,\n          desc: _desc,\n          price: _price,\n          publishDate: _publishDate,\n          author: _author,\n          image: _image,\n          total: _total\n        });\n        this.setState({\n          hasData: true\n        });\n      } else {\n        this.setState({\n          hasData: false\n        });\n      }\n    } catch (e) {\n      console.log('Error', e);\n    }\n  }\n\n  async buyArt(tokenId, priceInEther) {\n    try {\n      const priceInWei = window.web3.utils.toWei(priceInEther, 'ether');\n      await this.state.contractInstance.methods.buyArt(tokenId).send({\n        from: this.state.user,\n        gas: 6000000,\n        value: priceInWei\n      });\n      window.location.reload();\n    } catch (e) {\n      console.log('Error', e);\n    }\n  }\n\n  render() {\n    if (this.state.hasData) {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 121\n        },\n        __self: this\n      }, React.createElement(AppNav, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122\n        },\n        __self: this\n      }), React.createElement(\"section\", {\n        className: \"text-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        className: \"h1-responsive font-weight-bold text-center my-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, \"Buy/Sell Digital Art on our Art Gallery\"), React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, this.state.rows.map((row, i) => React.createElement(\"div\", {\n        className: \"row\",\n        key: i,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127\n        },\n        __self: this\n      }, this.state.columns.map((col, j) => React.createElement(\"div\", {\n        className: \"col-lg-4 col-md-12 mb-lg-0 mb-0\",\n        key: j,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, i * 3 + j < this.state.total && React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"view overlay rounded z-depth-3 mb-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 132\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        className: \"img-fluid\",\n        src: this.state.image[i * 3 + j],\n        alt: \"Sample\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      })), React.createElement(\"h6\", {\n        className: \"pink-text font-weight-bold mb-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, React.createElement(\"i\", {\n        className: \"fas fa-map pr-2\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"font-weight-bold orange-text deep-orange-lighter-hover\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, \"TokenId: \", this.state.tokenIds[i * 3 + j]), React.createElement(\"h5\", {\n        className: \"font-weight-bold mb-1\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }, \"Title: \", this.state.title[i * 3 + j]), React.createElement(\"div\", {\n        className: \"dark-grey-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }, this.state.price[i * 3 + j], \" (ether)\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, \"by \", React.createElement(\"span\", {\n        className: \"font-weight-bold\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, this.state.author[i * 3 + j]), \", \", this.state.publishDate[i * 3 + j]), React.createElement(\"p\", {\n        className: \"alert alert-primary dark-grey-text\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }, this.state.desc[i * 3 + j]), React.createElement(\"button\", {\n        className: \"btn btn-pink btn-rounded btn-md\",\n        onClick: e => {\n          e.preventDefault();\n          this.buyArt(this.state.tokenIds[i * 3 + j], this.state.price[i * 3 + j]);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, \"Buy\")))))))));\n    } else {\n      return React.createElement(\"div\", {\n        className: \"App\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, React.createElement(AppNav, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157\n        },\n        __self: this\n      }), React.createElement(\"section\", {\n        className: \"text-center\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158\n        },\n        __self: this\n      }, React.createElement(\"h5\", {\n        className: \"h1-responsive font-weight-bold text-center my-5\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159\n        },\n        __self: this\n      }, \"Buy Digital Art on our Art Gallery\"), React.createElement(\"div\", {\n        className: \"container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"alert alert-primary\",\n        role: \"alert\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161\n        },\n        __self: this\n      }, \"Publish your digital arts in blockchain today!\"))));\n    }\n  }\n\n}\n\nexport default ArtHome;","map":{"version":3,"sources":["/home/shkwon/Projects/Learn_Ethereum/chapter10/DigitalArtERC721Token/dapp/src/ArtHome.js"],"names":["React","AppNav","getWeb3","getInstance","ArtHome","Component","constructor","props","componentDidMount","web3","window","contractInstance","user","eth","getAccounts","setState","loadDigitalArts","state","hasData","message","rows","columns","tokenIds","title","desc","price","publishDate","author","image","total","buyArt","bind","resetPendingArts","ids","result","methods","findAllPendingArt","call","_total","length","row","Math","ceil","rowArr","Array","apply","map","Number","colArr","_tokenIds","_title","_desc","_price","_publishDate","_image","_author","idx","i","j","tokenId","art","findArt","priceInEther","utils","fromWei","push","e","console","log","priceInWei","toWei","send","from","gas","value","location","reload","render","col","preventDefault"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport AppNav from \"./AppNav\";\nimport { getWeb3, getInstance } from \"./Web3Util\";\n\nclass ArtHome extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      hasData: false,\n      message: \"\",\n      rows: [],\n      columns: [],\n      //user: '',\n      tokenIds: [],\n      title: [],\n      desc: [],\n      price: [],\n      publishDate: [],\n      author: [],\n      image: [],\n      total: 0,\n      contractInstance: '',\n      user: ''\n    };\n    this.buyArt = this.buyArt.bind(this);\n  }\n  resetPendingArts() {\n    this.setState({\n      tokenIds: [],\n      title: [],\n      desc: [],\n      price: [],\n      publishDate: [],\n      author: [],\n      image: [],\n      total: 0\n    });\n  }\n  componentDidMount = async () => {\n    const web3 = await getWeb3();\n    window.web3 = web3;\n    const contractInstance = await getInstance(web3);\n    window.user = (await web3.eth.getAccounts())[0];\n    this.setState({ user: window.user });\n    this.setState({ contractInstance: contractInstance });\n    await this.loadDigitalArts(web3);\n\n  }\n  async loadDigitalArts(web3) {\n    try {\n      let ids;\n      const result = await this.state.contractInstance.methods.findAllPendingArt().call();\n      ids = result[0];\n      let _total = ids.length;\n      if (ids && _total > 0) {\n        let row;\n        if (_total <= 3) {\n          row = 1;\n        } else {\n          row = Math.ceil(_total / 3);\n        }\n        let columns = 3;\n        this.setState({ rows: [], columns: [] });\n        let rowArr = Array.apply(null, { length: row }).map(Number.call, Number);\n        let colArr = Array.apply(null, { length: columns }).map(Number.call, Number);\n        this.setState({ rows: rowArr, columns: colArr });\n        let _tokenIds = [], _title = [], _desc = [], _price = [], _publishDate = [], _image = [], _author = [];\n        let idx = 0;\n        this.resetPendingArts();\n        for (let i = 0; i < row; i++) {\n          for (let j = 0; j < columns; j++) {\n            if (idx < _total) {\n              let tokenId = ids[idx];\n              const art = await this.state.contractInstance.methods.findArt(tokenId).call();\n              const priceInEther = web3.utils.fromWei(art[3], 'ether');\n              _tokenIds.push(art[0]);\n              _title.push(art[1]);\n              _desc.push(art[2]);\n              _price.push(priceInEther);\n              _publishDate.push(art[5]);\n              _image.push(art[9]);\n              _author.push(art[6]);\n            }\n            idx++;\n          }\n        }\n\n        this.setState({\n          tokenIds: _tokenIds,\n          title: _title,\n          desc: _desc,\n          price: _price,\n          publishDate: _publishDate,\n          author: _author,\n          image: _image,\n          total: _total\n        });\n        this.setState({ hasData: true });\n      } else {\n        this.setState({ hasData: false });\n      }\n\n    } catch (e) { console.log('Error', e) }\n\n  }\n  async buyArt(tokenId, priceInEther) {\n    try {\n      const priceInWei = window.web3.utils.toWei(priceInEther, 'ether');\n      await this.state.contractInstance.methods.buyArt(tokenId).send({\n        from: this.state.user, gas: 6000000, value: priceInWei\n      })\n      window.location.reload();\n    } catch (e) { console.log('Error', e) }\n  };\n\n  render() {\n    if (this.state.hasData) {\n      return (\n        <div className=\"App\">\n          <AppNav></AppNav>\n          <section className=\"text-center\">\n            <h5 className=\"h1-responsive font-weight-bold text-center my-5\">Buy/Sell Digital Art on our Art Gallery</h5>\n            <div className=\"container\">\n              {this.state.rows.map((row, i) =>\n                <div className=\"row\" key={i}>\n                  {this.state.columns.map((col, j) =>\n                    <div className=\"col-lg-4 col-md-12 mb-lg-0 mb-0\" key={j}>\n                      {i * 3 + j < this.state.total &&\n                        <div>\n                          <div className=\"view overlay rounded z-depth-3 mb-2\">\n                            <img className=\"img-fluid\" src={this.state.image[i * 3 + j]} alt=\"Sample\" />\n                          </div>\n                          <h6 className=\"pink-text font-weight-bold mb-1\"><i className=\"fas fa-map pr-2\"></i></h6>\n                          <div className=\"font-weight-bold orange-text deep-orange-lighter-hover\">TokenId: {this.state.tokenIds[i * 3 + j]}</div>\n                          <h5 className=\"font-weight-bold mb-1\">Title: {this.state.title[i * 3 + j]}</h5>\n                          <div className=\"dark-grey-text\">{this.state.price[i * 3 + j]} (ether)</div>\n                          <p>by <span className=\"font-weight-bold\">{this.state.author[i * 3 + j]}</span>, {this.state.publishDate[i * 3 + j]}</p>\n\n                          <p className=\"alert alert-primary dark-grey-text\">{this.state.desc[i * 3 + j]}</p>\n                          <button className=\"btn btn-pink btn-rounded btn-md\" onClick={(e) => { e.preventDefault(); this.buyArt(this.state.tokenIds[i * 3 + j], this.state.price[i * 3 + j]) }}>Buy</button>\n                        </div>\n                      }\n                    </div>\n\n                  )}\n                </div>\n              )}\n            </div>\n          </section>\n        </div>\n      );\n    } else {\n      return (\n        <div className=\"App\">\n          <AppNav></AppNav>\n          <section className=\"text-center\">\n            <h5 className=\"h1-responsive font-weight-bold text-center my-5\">Buy Digital Art on our Art Gallery</h5>\n            <div className=\"container\">\n              <div className=\"alert alert-primary\" role=\"alert\">\n                Publish your digital arts in blockchain today!\n              </div>\n            </div>\n          </section>\n        </div>\n      );\n    }\n\n  }\n}\n\nexport default ArtHome;\n"]},"metadata":{},"sourceType":"module"}